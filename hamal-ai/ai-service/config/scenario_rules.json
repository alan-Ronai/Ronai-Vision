{
  "scenarios": [
    {
      "_id": "armed-attack-scenario",
      "name": "转拽驻 砖",
      "description": "转专砖 砖   - 专   砖",
      "enabled": true,
      "singleInstance": true,
      "variants": [
        {
          "id": "stolen-vehicle",
          "name": "专  + 砖",
          "description": " 专 ,  转  砖",
          "icon": "",
          "entryStage": "VEHICLE_DETECTED",
          "trigger": {
            "type": "detection",
            "conditions": {
              "objectType": "vehicle",
              "hasLicensePlate": true,
              "plateInStolenList": true
            }
          },
          "stageFlow": [
            "IDLE",
            "VEHICLE_DETECTED",
            "VEHICLE_ALERT",
            "EMERGENCY_MODE",
            "RESPONSE_INITIATED",
            "DRONE_DISPATCHED",
            "CIVILIAN_ALERT",
            "CODE_BROADCAST",
            "SOLDIER_VIDEO",
            "NEW_CAMERA",
            "SITUATION_END"
          ],
          "demoControls": [
            {
              "id": "start",
              "label": "转 转专砖 (专 )",
              "action": "start",
              "color": "yellow",
              "enabledWhen": "!active"
            },
            {
              "id": "add-armed",
              "label": "住祝 砖",
              "labelTemplate": "住祝 砖 ({armedCount}/{armedThreshold})",
              "action": "add-armed-person",
              "color": "red",
              "enabledWhen": "stage === 'VEHICLE_ALERT'"
            }
          ]
        },
        {
          "id": "armed-person",
          "name": "砖 ",
          "description": " 砖专 砖  砖 - 注专  专",
          "icon": "",
          "entryStage": "ARMED_PERSON_DETECTED",
          "trigger": {
            "type": "detection",
            "conditions": {
              "objectType": "person",
              "armed": true
            }
          },
          "stageFlow": [
            "IDLE",
            "ARMED_PERSON_DETECTED",
            "EMERGENCY_MODE",
            "RESPONSE_INITIATED",
            "DRONE_DISPATCHED",
            "CIVILIAN_ALERT",
            "CODE_BROADCAST",
            "SOLDIER_VIDEO",
            "NEW_CAMERA",
            "SITUATION_END"
          ],
          "demoControls": [
            {
              "id": "start",
              "label": "转 转专砖 (砖 )",
              "action": "start-armed",
              "color": "red",
              "enabledWhen": "!active"
            }
          ]
        }
      ],
      "stages": [
        {
          "id": "IDLE",
          "name": "爪 专",
          "description": "注专转 爪 专 专",
          "isInitial": true,
          "transitions": []
        },
        {
          "id": "VEHICLE_DETECTED",
          "name": "专 ",
          "description": "专   注专转",
          "variantOnly": ["stolen-vehicle"],
          "autoTransition": true,
          "autoTransitionDelay": 0,
          "transitions": [
            {
              "to": "VEHICLE_ALERT",
              "trigger": { "type": "auto" }
            }
          ],
          "onEnter": [
            {
              "type": "store_context",
              "params": {
                "key": "vehicle",
                "fromDetection": true
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "专  住 转",
                "description": "转 专砖: {vehicle.licensePlate}\n爪注: {vehicle.color}\n爪专: {vehicle.make} {vehicle.model}"
              }
            }
          ]
        },
        {
          "id": "VEHICLE_ALERT",
          "name": "转专转 专",
          "description": "转专 注 专  - 转  砖",
          "variantOnly": ["stolen-vehicle"],
          "transitions": [
            {
              "to": "EMERGENCY_MODE",
              "trigger": {
                "type": "threshold",
                "conditions": {
                  "armedPersonCount": { "gte": 1 }
                }
              }
            },
            {
              "to": "SITUATION_END",
              "trigger": {
                "type": "timeout",
                "timeout": 120000,
                "reason": "timeout_no_armed"
              }
            },
            {
              "to": "SITUATION_END",
              "trigger": {
                "type": "manual",
                "action": "false_alarm"
              }
            }
          ],
          "onEnter": [
            {
              "type": "alert_popup",
              "params": {
                "alertType": "vehicle",
                "type": "warning",
                "title": "专  !",
                "autoDismiss": false
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "warning",
                "title": "专  ",
                "description": "转 专砖: {vehicle.licensePlate}\n爪注: {vehicle.color}\n爪专/: {vehicle.make} {vehicle.model}\n爪: {vehicle.cameraId}"
              }
            },
            {
              "type": "tts",
              "params": {
                "message": "专  ! 爪注 {vehicle.color}, {vehicle.make} {vehicle.model}, 住驻专 专 {vehicle.licensePlate}",
                "priority": "high"
              }
            },
            {
              "type": "camera_focus",
              "params": {
                "cameraId": "{vehicle.cameraId}",
                "reason": " 专 "
              }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "alert",
                "loop": false
              }
            }
          ],
          "whileActive": [
            {
              "type": "track_armed_persons",
              "params": {
                "storeAs": "persons",
                "countAs": "armedCount"
              }
            }
          ]
        },
        {
          "id": "ARMED_PERSON_DETECTED",
          "name": "砖 ",
          "description": " 砖  - 拽转 住 驻转. 转 4 砖转 住祝  住驻.",
          "variantOnly": ["armed-person"],
          "autoTransition": true,
          "autoTransitionDelay": 4000,
          "gatheringWindow": true,
          "transitions": [
            {
              "to": "EMERGENCY_MODE",
              "trigger": { "type": "auto" }
            }
          ],
          "onEnter": [
            {
              "type": "store_context",
              "params": {
                "key": "firstArmedPerson",
                "fromDetection": true
              }
            },
            {
              "type": "track_armed_persons",
              "params": {
                "storeAs": "persons",
                "countAs": "armedCount"
              }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "alert",
                "repeatCount": 1
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "warning",
                "title": "砖  - 住祝 注",
                "description": "  砖, 转 4 砖转  住驻..."
              }
            }
          ]
        },
        {
          "id": "EMERGENCY_MODE",
          "name": "爪 专",
          "description": "  - 爪 专 驻注",
          "transitions": [
            {
              "to": "RESPONSE_INITIATED",
              "trigger": {
                "type": "manual",
                "action": "acknowledge"
              }
            },
            {
              "to": "RESPONSE_INITIATED",
              "trigger": {
                "type": "timeout",
                "timeout": 15000
              }
            },
            {
              "to": "SITUATION_END",
              "trigger": {
                "type": "manual",
                "action": "false_alarm"
              }
            }
          ],
          "onEnter": [
            {
              "type": "danger_mode",
              "params": { "active": true }
            },
            {
              "type": "emergency_modal",
              "params": {
                "title": "专 转!",
                "subtitle": "{armedCount} 砖 ",
                "showVehicle": "{hasVehicle}",
                "showPersons": true
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "critical",
                "title": "专 转",
                "description": " {armedCount} 砖\n{vehicleInfo}\n砖:\n{persons_summary}"
              }
            },
            {
              "type": "tts",
              "params": {
                "message": " {armedCount} 砖. {persons_descriptions}",
                "priority": "critical"
              }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "alarm",
                "repeatCount": 2
              }
            },
            {
              "type": "start_recording",
              "params": {
                "preBuffer": 5,
                "duration": 10
              }
            }
          ]
        },
        {
          "id": "RESPONSE_INITIATED",
          "name": "转 驻注",
          "description": "砖转砖 砖专 - 驻注 转",
          "transitions": [
            {
              "to": "DRONE_DISPATCHED",
              "trigger": {
                "type": "transcription",
                "keywords": ["专驻"]
              }
            },
            {
              "to": "DRONE_DISPATCHED",
              "trigger": {
                "type": "timeout",
                "timeout": 120000
              }
            }
          ],
          "onEnter": [
            {
              "type": "close_modal",
              "params": {}
            },
            {
              "type": "tts",
              "params": {
                "message": "转转 转, 砖  专 转",
                "priority": "critical"
              }
            },
            {
              "type": "simulation",
              "params": {
                "type": "phone_call",
                "title": "转拽砖专 驻拽 转专..."
              }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "phoneDial",
                "loop": false
              }
            },
            {
              "type": "delay",
              "params": { "ms": 3000 }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "phoneRing",
                "repeatCount": 3
              }
            },
            {
              "type": "delay",
              "params": { "ms": 3000 }
            },
            {
              "type": "simulation",
              "params": {
                "type": "phone_connected",
                "title": "驻拽 转专 拽"
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "转拽砖专转 驻拽 转专",
                "description": "驻注 转拽砖专转 转 驻拽 转专"
              }
            }
          ]
        },
        {
          "id": "DRONE_DISPATCHED",
          "name": "专驻 拽驻抓",
          "description": "专驻 专 专 专注",
          "autoTransition": true,
          "autoTransitionDelay": 5000,
          "transitions": [
            {
              "to": "CIVILIAN_ALERT",
              "trigger": { "type": "auto" }
            }
          ],
          "onEnter": [
            {
              "type": "simulation",
              "params": {
                "type": "drone_dispatch",
                "title": "专驻 拽驻抓"
              }
            },
            {
              "type": "play_sound",
              "params": {
                "sound": "droneTakeoff",
                "loop": false
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "专驻 拽驻抓",
                "description": "专驻 拽驻抓 专 专注"
              }
            },
            {
              "type": "delay",
              "params": { "ms": 3000 }
            },
            {
              "type": "simulation",
              "params": {
                "type": "drone_enroute",
                "title": "专驻 专 注"
              }
            }
          ]
        },
        {
          "id": "CIVILIAN_ALERT",
          "name": "专 专",
          "description": "转 转 拽 砖专",
          "transitions": [
            {
              "to": "CODE_BROADCAST",
              "trigger": {
                "type": "transcription",
                "keywords": ["爪驻专注"]
              }
            },
            {
              "to": "CODE_BROADCAST",
              "trigger": {
                "type": "timeout",
                "timeout": 60000
              }
            }
          ],
          "onEnter": [
            {
              "type": "tts",
              "params": {
                "message": "转砖 拽专, 转拽 专注  专.  住 专  砖专 转 注 注 砖.",
                "priority": "critical"
              }
            },
            {
              "type": "simulation",
              "params": {
                "type": "pa_announcement",
                "title": "专 专 爪注"
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "warning",
                "title": "专 专",
                "description": "爪注 专转 转专注 专"
              }
            }
          ]
        },
        {
          "id": "CODE_BROADCAST",
          "name": "拽 砖专",
          "description": "转 住专 ",
          "transitions": [
            {
              "to": "SOLDIER_VIDEO",
              "trigger": {
                "type": "upload",
                "endpoint": "soldier-video"
              }
            },
            {
              "to": "NEW_CAMERA",
              "trigger": {
                "type": "timeout",
                "timeout": 60000
              }
            }
          ],
          "onEnter": [
            {
              "type": "tts",
              "params": {
                "message": "爪驻专注 爪驻专注 爪驻专注",
                "priority": "high"
              }
            },
            {
              "type": "simulation",
              "params": {
                "type": "code_broadcast",
                "title": "拽 砖专: 爪驻专注"
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "拽 砖专",
                "description": "拽 \"爪驻专注\" 砖专 3 驻注"
              }
            }
          ]
        },
        {
          "id": "SOLDIER_VIDEO",
          "name": "住专 ",
          "description": "爪 住专  注 转",
          "transitions": [
            {
              "to": "NEW_CAMERA",
              "trigger": {
                "type": "manual",
                "action": "close_video_panel"
              }
            }
          ],
          "onEnter": [
            {
              "type": "soldier_video_panel",
              "params": { "open": true }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "住专  转拽",
                "description": "住专  转拽 爪"
              }
            }
          ]
        },
        {
          "id": "NEW_CAMERA",
          "name": "爪 砖",
          "description": "转 专 爪 砖  住",
          "transitions": [
            {
              "to": "SITUATION_END",
              "trigger": {
                "type": "transcription",
                "keywords": ["  ", "", "住祝 专注"]
              }
            },
            {
              "to": "SITUATION_END",
              "trigger": {
                "type": "manual",
                "action": "end_scenario"
              }
            }
          ],
          "onEnter": [
            {
              "type": "new_camera_dialog",
              "params": { "open": true }
            }
          ]
        },
        {
          "id": "SITUATION_END",
          "name": "住 专注",
          "description": "专注 住转",
          "isFinal": true,
          "transitions": [],
          "onEnter": [
            {
              "type": "danger_mode",
              "params": { "active": false }
            },
            {
              "type": "stop_all_sounds",
              "params": {}
            },
            {
              "type": "stop_recording",
              "params": {}
            },
            {
              "type": "summary_popup",
              "params": {
                "title": "专注 住转"
              }
            },
            {
              "type": "journal",
              "params": {
                "severity": "info",
                "title": "专注 住转",
                "description": "专注 住转 - 住: {end_reason}\n砖: {duration}"
              }
            },
            {
              "type": "cleanup",
              "params": { "delay": 5000 }
            }
          ]
        }
      ],
      "context": {
        "vehicle": null,
        "persons": [],
        "armedCount": 0,
        "startedAt": null,
        "acknowledged": false,
        "endReason": null,
        "activeVariant": null
      },
      "config": {
        "stolenVehicles": [
          { "plate": "DEMO-123", "color": "砖专", "make": "", "model": "拽专" },
          { "plate": "123-45-678", "color": "", "make": "", "model": "i20" },
          { "plate": "TEST-001", "color": "", "make": "", "model": "3" }
        ],
        "armedThreshold": 1,
        "reannounceThreshold": 2,
        "keywords": {
          "drone": ["专驻"],
          "code": ["爪驻专注"],
          "end": ["  ", "", "住祝 专注"]
        }
      },
      "demoConfig": {
        "dataSources": [
          {
            "id": "fake",
            "name": "转 ",
            "description": "转   专砖"
          },
          {
            "id": "real",
            "name": "转 住爪 转",
            "description": "砖砖 拽 砖 住爪 转"
          }
        ],
        "sharedControls": [
          {
            "id": "drone-keyword",
            "label": "砖 \"专驻\"",
            "action": "transcription",
            "params": { "text": "专驻" },
            "color": "purple",
            "enabledWhen": "stage === 'RESPONSE_INITIATED'"
          },
          {
            "id": "code-keyword",
            "label": "砖 \"爪驻专注\"",
            "action": "transcription",
            "params": { "text": "爪驻专注" },
            "color": "orange",
            "enabledWhen": "stage === 'CIVILIAN_ALERT'"
          },
          {
            "id": "end-keyword",
            "label": "砖 \"\" (住)",
            "action": "transcription",
            "params": { "text": "  " },
            "color": "green",
            "enabledWhen": "stage === 'NEW_CAMERA'"
          },
          {
            "id": "advance",
            "label": "拽 砖 ()",
            "action": "advance",
            "color": "blue",
            "enabledWhen": "active"
          },
          {
            "id": "reset",
            "label": "驻住 转专砖",
            "action": "reset",
            "color": "gray",
            "enabledWhen": "active"
          }
        ]
      }
    }
  ],
  "version": "2.0.0",
  "lastUpdated": null
}
